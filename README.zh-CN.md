<div align="center">

# [🔍 搜索式 NL2SQL：让数据查询回归本质](https://github.com/boluo2077/search-nl2sql)

**[ [English](README.md) | 中文 ]**

</div>

---

### 什么是搜索式 NL2SQL？

想象一下，当你在淘宝搜索商品时，你会输入"请帮我在商品库中查找价格在 100 到 200 元之间的蓝色连衣裙"吗？当然不会！你只会输入：**"连衣裙 蓝色 100-200"**

**搜索式 NL2SQL** 正是将这种直觉化的搜索思维引入数据库查询领域的创新方法。它让用户像使用搜索引擎一样查询数据库——**输入关键词，系统智能理解**

---

## 📊 两种方式的本质区别

### 🔹 普通 NL2SQL System Prompt 示例

```
- 今天是 2025 年 6 月 6 日

《表结构与数据类型》

表名：Products（产品）
product_id：VARCHAR（产品ID）
product_name：VARCHAR（产品名称）
product_price：DECIMAL（产品单价）
product_stock：INT（产品库存）
product_launch_date：DATETIME（产品上架时间）

表名：Customers（客户）
customer_id：VARCHAR（客户ID）
customer_name：VARCHAR（客户姓名）
customer_phone：VARCHAR（客户电话）
customer_address：VARCHAR（客户地址）
customer_registration_date：DATETIME（客户注册时间）

表名：Orders（订单）
order_id：VARCHAR（订单ID）
customer_id：VARCHAR（客户ID）
customer_name：VARCHAR（客户姓名）
order_amount：DECIMAL（订单金额）
order_address：VARCHAR（订单地址）
order_creation_date：DATETIME（订单创建时间）
```

**特点**：提供抽象的表结构定义，AI 需要理解 字段类型 和 关系

---

### 🔹 搜索式 NL2SQL System Prompt 示例

```
- 今天是 2025 年 6 月 6 日
- 根据数据的样子，反推字段，再根据字段进一步反推表
- 使用 SQL 代码解释器工具前，先介绍反推思路
- 若可能的 SQL 不止一条，让用户做选择题

《表结构与数据示例》

表名：Products（产品）
product_id：p-985
product_name：QB826G充电宝（产品名称）
product_price：200（产品单价）
product_stock：100（产品库存）
product_launch_data：2025-06-03 10:00:00（产品上架时间）

表名：Customers（客户）
customer_id：c-99
customer_name：李四（客户姓名）
customer_phone：13812345678（客户电话）
customer_address：中国北京市海淀区YY路2号（客户地址）
customer_registration_date：2025-06-02 10:00:00（客户注册时间）

表名：Orders（订单）
order_id：o-8848
customer_id：c-66
customer_name：张三（客户姓名）
order_amount：400（订单金额）
order_address：中国北京市朝阳区XX路1号（订单地址）
order_creation_date：2025-06-01 10:00:00（订单创建时间）
```

**特点**：提供真实数据样例，AI 通过"看到数据的样子"来理解用户输入的含义

---

## 💡 设计理念

### 1️⃣ **反推思维**
从数据样本反推字段特征：
- 看到 `13812345678` → 推断为电话号码
- 看到 `QB826G充电宝` → 推断为产品名称
- 看到 `上海` → 推断可能是地址字段

### 2️⃣ **语义压缩**
支持自然语言的极简表达：
- `昨天` → `BETWEEN '2025-06-05' AND '2025-06-06'`
- `去年` → `BETWEEN '2024-01-01' AND '2025-01-01'`
- `500-1000` → `BETWEEN 500 AND 1000`
- `>500` / `<500` → 自动识别比较运算符

### 3️⃣ **智能决策**
当存在多种可能的解释时，让用户做选择题：

```
您输入了："李华"

我推断可能有以下查询意图：
A. 在客户表中查找姓名为"李华"的客户
B. 在订单表中查找客户姓名为"李华"的订单

请选择：A 或 B？
```

---

## 🎯 交互效果对比：效率的革命性提升

> **📌 计数说明**：
> - 以下所有字符数均为**中文字符数**
> - **电话号码**通常通过复制粘贴输入，记为 **4 个中文字符**（Ctrl + C 和 Ctrl + V 的操作成本）

---

### 📱 场景一：查询单个客户信息

| 方式 | 用户输入 | 字符数 | 效率提升 |
|------|---------|--------|----------|
| **普通 NL2SQL** | 请帮我查一下，在客户信息表里面，电话号码是15690374821的那位客户的所有相关信息 | 37 字符 | - |
| **搜索式 NL2SQL** | `15690374821` | 4 字符 | **🚀 825%** |

**期望 SQL**：`SELECT * FROM Customers WHERE customer_phone = '15690374821'`

---

### 📱 场景二：查询多个客户信息

| 方式 | 用户输入 | 字符数 | 效率提升 |
|------|---------|--------|----------|
| **普通 NL2SQL** | 请帮我查一下，在我们的客户数据中，客户的联系电话分别是15690374821或者13826548392的全部资料 | 42 字符 | - |
| **搜索式 NL2SQL** | `15690374821 13826548392` | 9 字符 | **🚀 367%** |

**期望 SQL**：`SELECT * FROM Customers WHERE customer_phone IN ('15690374821', '13826548392')`

---

### 💰 场景三：精确金额查询

| 方式 | 用户输入 | 字符数 | 效率提升 |
|------|---------|--------|----------|
| **普通 NL2SQL** | 请帮我查一下订单记录，我想找到客户姓名叫做李华并且该客户的订单金额正好是500元的那些订单的详细信息 | 50 字符 | - |
| **搜索式 NL2SQL** | `李华 500` | 6 字符 | **🚀 733%** |

**期望 SQL**：`SELECT * FROM Orders WHERE customer_name = '李华' AND order_amount = 500`

---

### 💰 场景四：比较运算符查询

| 方式 | 用户输入 | 字符数 | 效率提升 |
|------|---------|--------|----------|
| **普通 NL2SQL** | 请帮我查一下订单记录，我想找到客户姓名叫做李华并且该客户的订单金额小于500元的那些订单的详细信息 | 49 字符 | - |
| **搜索式 NL2SQL** | `李华 <500` | 7 字符 | **🚀 600%** |

**期望 SQL**：`SELECT * FROM Orders WHERE customer_name = '李华' AND order_amount < 500`

---

### 🌍 场景五：模糊搜索 + 范围查询

| 方式 | 用户输入 | 字符数 | 效率提升 |
|------|---------|--------|----------|
| **普通 NL2SQL** | 请帮我查一下，在所有订单信息里，所有那些订单的配送地址字段中包含上海这两个字，并且这些订单的实际付款金额要大于500元的订单记录 | 64 字符 | - |
| **搜索式 NL2SQL** | `上海 >500` | 7 字符 | **🚀 814%** |

**期望 SQL**：`SELECT * FROM Orders WHERE order_address LIKE '%上海%' AND order_amount > 500`

---

### 🌍 场景六：BETWEEN 范围查询

| 方式 | 用户输入 | 字符数 | 效率提升 |
|------|---------|--------|----------|
| **普通 NL2SQL** | 请帮我查一下，订单表里那些订单的收货地址中包含上海这个城市，并且这些订单的总金额是在500元到1000元之间的所有订单的完整记录 | 64 字符 | - |
| **搜索式 NL2SQL** | `上海 500-1000` | 11 字符 | **🚀 482%** |

**期望 SQL**：`SELECT * FROM Orders WHERE order_address LIKE '%上海%' AND order_amount BETWEEN 500 AND 1000`

---

### 📅 场景七：时间相对查询

| 方式 | 用户输入 | 字符数 | 效率提升 |
|------|---------|--------|----------|
| **普通 NL2SQL** | 请帮我查一下产品库，看看有没有产品的名称字段包含手机壳这几个字，并且这些产品的上架时间是在昨天这一天内的所有产品信息 | 58 字符 | - |
| **搜索式 NL2SQL** | `手机壳 昨天` | 6 字符 | **🚀 867%** |

**期望 SQL**：`SELECT * FROM Products WHERE product_name LIKE '%手机壳%' AND product_launch_date BETWEEN '2025-06-05' AND '2025-06-06'`

---

### 🎯 场景八：复杂多条件组合查询

| 方式 | 用户输入 | 字符数 | 效率提升 |
|------|---------|--------|----------|
| **普通 NL2SQL** | 我想综合查询一下订单数据：请找出所有在去年创建的订单，同时满足以下几个条件：第一，这些订单的配送地址需要包含上海；第二，下订单的客户姓名是王五或者赵六；第三，这些订单的金额必须大于500元。请列出所有符合这些条件的订单的全部详细信息 | 116 字符 | - |
| **搜索式 NL2SQL** | `去年 上海 王五 赵六 >500` | 16 字符 | **🚀 625%** |

**期望 SQL**：
```sql
SELECT * FROM Orders
WHERE order_creation_date BETWEEN '2024-01-01' AND '2025-01-01'
  AND order_address LIKE '%上海%'
  AND customer_name IN ('王五', '赵六')
  AND order_amount > 500
```

---

## 📏 字符数对比

| 场景类型 | 普通方式 | 搜索式 | 节省字符 | 效率提升 |
|---------|---------|--------|---------|---------|
| 单电话查询 | 37 | **4** | 33 | 825% |
| 双电话查询 | 42 | **9** | 33 | 367% |
| 姓名 + 精确金额 | 50 | **6** | 44 | 733% |
| 姓名 + 比较运算 | 49 | **7** | 42 | 600% |
| 地址 + 比较运算 | 64 | **7** | 57 | 814% |
| 地址 + 范围查询 | 64 | **11** | 53 | 482% |
| 产品 + 时间查询 | 58 | **6** | 52 | 867% |
| 复杂多条件 | 116 | **16** | 100 | 625% |

---

## 🎯 核心优势

### ✅ **认知负担骤降**
不再需要思考"怎么描述"，只需输入"我知道的"

### ✅ **操作效率飙升**
平均输入效率提升 **600% - 800%**，复制粘贴即可完成查询

### ✅ **学习成本归零**
就像用 Google 搜索一样直觉，0 门槛上手

### ✅ **容错能力更强**
关键词顺序无关紧要：`李华 500` 等价于 `500 李华`

---

## 🌟 总结

**搜索式 NL2SQL** 不是简单的技术优化，而是**交互范式的转变**。它让数据查询从"对话"回归"搜索"，从"描述需求"回归"输入关键词"，让机器理解人类最自然的表达方式

> 最好的技术，是让用户感觉不到技术的存在

---

<div align="center">

**如果这个项目对你有帮助，请点击右上角的 ⭐ Star！**

*你的 Star 是我们持续改进的动力 💪*

![Star History Chart](https://api.star-history.com/svg?repos=boluo2077/search-nl2sql&type=Date)

---

<a href="#-搜索式-nl2sql让数据查询回归本质">
  <img src="https://img.shields.io/badge/⬆️-回到顶部-blue?style=for-the-badge" alt="回到顶部">
</a>

</div>
